<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√†i kho·∫£n - DH Pharmacy</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="container">
                <div>üìû Hotline:0344864576 | üí¨ Zalo: 0344864576</div>
                <div>üöö Giao h√†ng nhanh 2-4 gi·ªù | ‚úÖ ƒê·∫£m b·∫£o ch·∫•t l∆∞·ª£ng</div>
            </div>
        </div>
        <div class="header-main">
            <div class="container">
                <a href="/pages/index.html" class="logo">
                    <span>üíä</span>
                    <span>DH Pharmacy</span>
                </a>
                <div class="search-bar">
                    <form>
                        <div class="input-search">
                            <input type="text" placeholder="T√¨m ki·∫øm thu·ªëc, ho·∫°t ch·∫•t, tri·ªáu ch·ª©ng...">
                        </div>
                        <div class="submit-button">
                            <button type="submit">üîç</button>
                        </div>
                    </form>
                </div>
                <nav class="nav">
                    <a href="/pages/index.html" class="nav-link">Trang ch·ªß</a>
                    <a href="/pages/products.html" class="nav-link">S·∫£n ph·∫©m</a>
                    <a href="/pages/consultation.html" class="nav-link">T∆∞ v·∫•n</a>
                    <a href="/pages/about.html" class="nav-link">Gi·ªõi thi·ªáu</a>
                    <div class="cart-icon">
                        <a href="/pages/cart.html" class="nav-link">üõí Gi·ªè h√†ng</a>
                        <span class="cart-badge" style="display: none;">0</span>
                    </div>
                    <div class="user-menu">
                        <a href="/pages/login.html" class="nav-link">ƒêƒÉng nh·∫≠p</a>
                        <a href="/pages/register.html" class="nav-link">ƒêƒÉng k√Ω</a>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <main style="padding: 40px 0;">
        <div class="container">
            <h1 style="margin-bottom: 30px;">T√†i kho·∫£n c·ªßa t√¥i</h1>

            <div class="grid grid-2" style="gap: 24px;">
                <div>
                    <div class="card" style="margin-bottom: 24px;">
                        <div class="card-header">
                            <h3>Th√¥ng tin c√° nh√¢n</h3>
                        </div>
                        <div class="card-body">
                            <form id="profile-form" onsubmit="updateProfile(event)">
                                <div class="form-group">
                                    <label class="form-label">H·ªç t√™n</label>
                                    <input type="text" class="form-control" id="name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="email" disabled>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
                                    <input type="tel" class="form-control" id="phone">
                                </div>
                                <button type="submit" class="btn btn-primary">C·∫≠p nh·∫≠t</button>
                            </form>
                        </div>
                    </div>

                    <div class="card" style="margin-bottom: 24px;">
                        <div class="card-header">
                            <h3>ƒê·ªïi m·∫≠t kh·∫©u</h3>
                        </div>
                        <div class="card-body">
                            <form id="password-form" onsubmit="changePassword(event)">
                                <div class="form-group">
                                    <label class="form-label">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                                    <input type="password" class="form-control" id="current-password" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">M·∫≠t kh·∫©u m·ªõi</label>
                                    <input type="password" class="form-control" id="new-password" required minlength="6">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                                    <input type="password" class="form-control" id="confirm-new-password" required>
                                </div>
                                <button type="submit" class="btn btn-primary">ƒê·ªïi m·∫≠t kh·∫©u</button>
                            </form>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="card" style="margin-bottom: 24px;">
                        <div class="card-header">
                            <h3>ƒê·ªãa ch·ªâ giao h√†ng</h3>
                        </div>
                        <div class="card-body">
                            <div id="addresses-list"></div>
                            <button class="btn btn-outline" onclick="showAddAddressForm()" style="margin-top: 16px;">Th√™m ƒë·ªãa ch·ªâ</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>H·ªì s∆° s·ª©c kh·ªèe</h3>
                        </div>
                        <div class="card-body">
                            <p>Qu·∫£n l√Ω th√¥ng tin s·ª©c kh·ªèe ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n t·ªët h∆°n</p>
                            <a href="/pages/health-profile.html" class="btn btn-outline">C·∫≠p nh·∫≠t h·ªì s∆°</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>DH Pharmacy</h3>
                    <p>Nh√† thu·ªëc tr·ª±c tuy·∫øn uy t√≠n, giao h√†ng nhanh, t∆∞ v·∫•n chuy√™n nghi·ªáp.</p>
                    <p>Gi·∫•y ph√©p: S·ªë 12345/GP-BYT</p>
                </div>
                <div class="footer-section">
                    <h3>Li√™n h·ªá</h3>
                    <p>üìû Hotline: 0344864576</p>
                    <p>üí¨ Zalo: 0344864576</p>
                    <p>üìß Email: dhpharmacy@gmail.com</p>
                    <p>üìç ƒê·ªãa ch·ªâ: S·ªë 3 ƒê√¥ng Ng√†n - T·ª´ S∆°n  - B·∫Øc Ninh</p>
                </div>
                <div class="footer-section">
                    <h3>H·ªó tr·ª£</h3>
                    <a href="/pages/about.html">Gi·ªõi thi·ªáu</a>
                    <a href="/pages/contact.html">Li√™n h·ªá</a>
                    <a href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t</a>
                    <a href="#">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a>
                    <a href="#">C√¢u h·ªèi th∆∞·ªùng g·∫∑p</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 DH Pharmacy. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="/js/api.js"></script>
    <script src="/js/main.js"></script>
    <script>
        async function loadProfile() {
            try {
                const response = await window.API.auth.getMe();
                const user = response.user;

                document.getElementById('name').value = user.name || '';
                document.getElementById('email').value = user.email || '';
                document.getElementById('phone').value = user.phone || '';

                await loadAddresses();
            } catch (error) {
                console.error('Error loading profile:', error);
                if (error.message.includes('401')) {
                    window.location.href = '/pages/login.html';
                }
            }
        }

        async function loadAddresses() {
            try {
                const response = await window.API.users.getAddresses();
                const addresses = response.data || [];
                const container = document.getElementById('addresses-list');

                if (addresses.length === 0) {
                    container.innerHTML = '<p>Ch∆∞a c√≥ ƒë·ªãa ch·ªâ n√†o</p>';
                    return;
                }

                container.innerHTML = addresses.map((addr, index) => `
                    <div class="card" style="margin-bottom: 16px;">
                        <div class="card-body">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <strong>${addr.name}</strong>
                                    ${addr.isDefault ? '<span class="badge badge-primary">M·∫∑c ƒë·ªãnh</span>' : ''}
                                    <p style="margin-top: 8px; margin-bottom: 0;">
                                        ${addr.address}, ${addr.ward}, ${addr.district}, ${addr.city}
                                    </p>
                                    <p style="margin-top: 4px; color: var(--text-light);">${addr.phone}</p>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline" onclick="editAddress('${addr._id}')">S·ª≠a</button>
                                    <button class="btn btn-sm btn-outline" onclick="deleteAddress('${addr._id}')" style="color: var(--error-color);">X√≥a</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading addresses:', error);
            }
        }

        async function updateProfile(e) {
            e.preventDefault();
            try {
                await window.API.auth.updateProfile({
                    name: document.getElementById('name').value,
                    phone: document.getElementById('phone').value
                });
                alert('C·∫≠p nh·∫≠t th√†nh c√¥ng!');
            } catch (error) {
                alert('C·∫≠p nh·∫≠t th·∫•t b·∫°i: ' + error.message);
            }
        }

        async function changePassword(e) {
            e.preventDefault();
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-new-password').value;

            if (newPassword !== confirmPassword) {
                alert('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp');
                return;
            }

            try {
                await window.API.auth.changePassword(
                    document.getElementById('current-password').value,
                    newPassword
                );
                alert('ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!');
                document.getElementById('password-form').reset();
            } catch (error) {
                alert('ƒê·ªïi m·∫≠t kh·∫©u th·∫•t b·∫°i: ' + error.message);
            }
        }

        function showAddAddressForm() {
            const name = prompt('H·ªç t√™n:');
            const phone = prompt('S·ªë ƒëi·ªán tho·∫°i:');
            const address = prompt('ƒê·ªãa ch·ªâ:');
            const ward = prompt('Ph∆∞·ªùng/X√£:');
            const district = prompt('Qu·∫≠n/Huy·ªán:');
            const city = prompt('Th√†nh ph·ªë:');

            if (name && phone && address && ward && district && city) {
                window.API.users.addAddress({
                    name, phone, address, ward, district, city
                }).then(() => {
                    loadAddresses();
                }).catch(error => {
                    alert('Th√™m ƒë·ªãa ch·ªâ th·∫•t b·∫°i: ' + error.message);
                });
            }
        }

        async function deleteAddress(addressId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë·ªãa ch·ªâ n√†y?')) {
                try {
                    await window.API.users.deleteAddress(addressId);
                    loadAddresses();
                } catch (error) {
                    alert('X√≥a ƒë·ªãa ch·ªâ th·∫•t b·∫°i: ' + error.message);
                }
            }
        }

        // Initialize
        loadProfile();
    </script>
</body>
</html>

