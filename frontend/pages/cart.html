<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·ªè h√†ng - DH Pharmacy</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="header-top">
            <div class="container">
                <div>üìû Hotline: 0344864576</div>
            </div>
        </div>
        <div class="header-main">
            <div class="container">
                <a href="/pages/index.html" class="logo">
                    <span>üíä</span>
                    <span>DH Pharmacy</span>
                </a>
                <nav class="nav">
                    <a href="/pages/index.html" class="nav-link">Trang ch·ªß</a>
                    <a href="/pages/products.html" class="nav-link">S·∫£n ph·∫©m</a>
                    <div class="cart-icon">
                        <a href="/pages/cart.html" class="nav-link active">üõí Gi·ªè h√†ng</a>
                        <span class="cart-badge" style="display: none;">0</span>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <main style="padding: 40px 0;">
        <div class="container">
            <h1 style="margin-bottom: 30px;">Gi·ªè h√†ng c·ªßa b·∫°n</h1>

            <div id="cart-content">
                <div class="text-center">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 DH Pharmacy. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="/js/api.js"></script>
    <script src="/js/cart.js"></script>
    <script src="/js/main.js"></script>
    <script>
        async function loadCart() {
            const container = document.getElementById('cart-content');
            const cart = window.Cart.getCart();

            if (cart.items.length === 0) {
                container.innerHTML = `
                    <div class="text-center" style="padding: 60px 0;">
                        <div style="font-size: 64px; margin-bottom: 24px;">üõí</div>
                        <h2>Gi·ªè h√†ng tr·ªëng</h2>
                        <p style="margin-bottom: 24px;">B·∫°n ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong gi·ªè h√†ng</p>
                        <a href="/pages/products.html" class="btn btn-primary">Ti·∫øp t·ª•c mua s·∫Øm</a>
                    </div>
                `;
                return;
            }

            try {
                let total = 0;
                const itemsHTML = [];

                for (const item of cart.items) {
                    const product = await window.API.products.getById(item.productId);
                    const productData = product.data;
                    const itemTotal = productData.price * item.quantity;
                    total += itemTotal;

                    itemsHTML.push(`
                        <div class="card" style="margin-bottom: 16px;">
                            <div class="card-body">
                                <div style="display: flex; gap: 24px; align-items: center;">
                                    <img src="${productData.images?.[0]?.url || '/assets/images/placeholder.jpg'}" 
                                         alt="${productData.name}" 
                                         style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px;"
                                         onerror="this.src='/assets/images/placeholder.jpg'">
                                    <div style="flex: 1;">
                                        <h3 style="margin-bottom: 8px;">${productData.name}</h3>
                                        <p style="color: var(--text-light); margin-bottom: 16px;">${productData.genericName || ''}</p>
                                        <div style="display: flex; gap: 24px; align-items: center;">
                                            <div>
                                                <label class="form-label">S·ªë l∆∞·ª£ng:</label>
                                                <div style="display: flex; gap: 8px; align-items: center;">
                                                    <button class="btn btn-sm btn-outline" onclick="updateItemQuantity('${item.productId}', -1)">-</button>
                                                    <span style="min-width: 40px; text-align: center;">${item.quantity}</span>
                                                    <button class="btn btn-sm btn-outline" onclick="updateItemQuantity('${item.productId}', 1)">+</button>
                                                </div>
                                            </div>
                                            <div>
                                                <div style="font-size: 20px; font-weight: 700; color: var(--primary-color);">
                                                    ${window.utils?.formatCurrency(productData.price) || productData.price.toLocaleString('vi-VN') + ' ƒë'}
                                                </div>
                                                <div style="font-size: 16px; color: var(--text-light);">
                                                    T·ªïng: ${window.utils?.formatCurrency(itemTotal) || itemTotal.toLocaleString('vi-VN') + ' ƒë'}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="btn btn-outline" onclick="removeItem('${item.productId}')" style="color: var(--error-color);">
                                        üóëÔ∏è X√≥a
                                    </button>
                                </div>
                            </div>
                        </div>
                    `);
                }

                container.innerHTML = `
                    <div class="grid grid-2" style="gap: 24px;">
                        <div>
                            ${itemsHTML.join('')}
                        </div>
                        <div>
                            <div class="card" style="position: sticky; top: 100px;">
                                <div class="card-header">
                                    <h3>T√≥m t·∫Øt ƒë∆°n h√†ng</h3>
                                </div>
                                <div class="card-body">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                                        <span>T·∫°m t√≠nh:</span>
                                        <span>${window.utils?.formatCurrency(total) || total.toLocaleString('vi-VN') + ' ƒë'}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                                        <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
                                        <span>${total >= 500000 ? 'Mi·ªÖn ph√≠' : '30.000 ƒë'}</span>
                                    </div>
                                    <hr style="margin: 24px 0; border: none; border-top: 1px solid var(--border-color);">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 24px;">
                                        <strong style="font-size: 18px;">T·ªïng c·ªông:</strong>
                                        <strong style="font-size: 20px; color: var(--primary-color);">
                                            ${window.utils?.formatCurrency(total + (total >= 500000 ? 0 : 30000)) || (total + (total >= 500000 ? 0 : 30000)).toLocaleString('vi-VN') + ' ƒë'}
                                        </strong>
                                    </div>
                                    <a href="/pages/checkout.html" class="btn btn-primary btn-block btn-lg">
                                        Thanh to√°n
                                    </a>
                                    <a href="/pages/products.html" class="btn btn-outline btn-block" style="margin-top: 16px;">
                                        Ti·∫øp t·ª•c mua s·∫Øm
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading cart:', error);
                container.innerHTML = '<p class="text-center text-error">Kh√¥ng th·ªÉ t·∫£i gi·ªè h√†ng</p>';
            }
        }

        function updateItemQuantity(productId, change) {
            const cart = window.Cart.getCart();
            const item = cart.items.find(i => i.productId === productId);
            if (item) {
                const newQuantity = Math.max(1, item.quantity + change);
                window.Cart.updateCartItem(productId, newQuantity);
                loadCart();
            }
        }

        function removeItem(productId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y?')) {
                window.Cart.removeFromCart(productId);
                loadCart();
            }
        }

        // Initialize
        loadCart();
    </script>
</body>
</html>

